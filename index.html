<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Mouse Check - Human Verification Demo</title>
  <meta name="description" content="A browser-based human verification system that detects AI/bot mouse control by analyzing movement patterns.">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #eee;
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #4cc9f0, #06d6a0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tagline {
      color: #888;
      font-size: 1.1rem;
    }

    .demo-section {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    h2 {
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: #4cc9f0;
    }

    p {
      color: #aaa;
      margin-bottom: 15px;
    }

    .btn {
      display: inline-block;
      padding: 14px 32px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(90deg, #4cc9f0, #06d6a0);
      color: #1a1a2e;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(76, 201, 240, 0.3);
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }

    .result.success {
      background: rgba(6, 214, 160, 0.2);
      border: 1px solid #06d6a0;
      display: block;
    }

    .result.failure {
      background: rgba(239, 71, 111, 0.2);
      border: 1px solid #ef476f;
      display: block;
    }

    .result h3 {
      margin-bottom: 10px;
    }

    .result pre {
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
      color: #ccc;
    }

    .ai-prompt-section {
      margin-top: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
    }

    .ai-prompt-section h4 {
      font-size: 0.9rem;
      margin-bottom: 10px;
      color: #4cc9f0;
    }

    .ai-prompt-box {
      position: relative;
    }

    .ai-prompt-box textarea {
      width: 100%;
      height: 200px;
      background: #0d1117;
      border: 1px solid #333;
      border-radius: 6px;
      color: #c9d1d9;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
      padding: 12px;
      resize: vertical;
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #4cc9f0;
      color: #1a1a2e;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600;
    }

    .copy-btn:hover {
      background: #06d6a0;
    }

    .copy-btn.copied {
      background: #06d6a0;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .feature {
      background: rgba(255,255,255,0.03);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .feature h3 {
      font-size: 1rem;
      margin-bottom: 8px;
      color: #06d6a0;
    }

    .feature p {
      font-size: 0.9rem;
      margin: 0;
    }

    .code-section {
      background: #0d1117;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
      overflow-x: auto;
    }

    .code-section code {
      color: #c9d1d9;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      white-space: pre;
    }

    .code-section .keyword { color: #ff7b72; }
    .code-section .string { color: #a5d6ff; }
    .code-section .function { color: #d2a8ff; }
    .code-section .comment { color: #8b949e; }

    footer {
      text-align: center;
      padding: 30px;
      color: #666;
      font-size: 0.9rem;
    }

    footer a {
      color: #4cc9f0;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .github-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #888;
      text-decoration: none;
      margin-top: 20px;
      padding: 10px 20px;
      border: 1px solid #333;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .github-link:hover {
      border-color: #4cc9f0;
      color: #4cc9f0;
    }

    .github-link svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>AI Mouse Check</h1>
      <p class="tagline">Human verification through mouse movement analysis</p>
      <a href="https://github.com/dshanklin-bv/ai-mouse-check" class="github-link">
        <svg viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
        View on GitHub
      </a>
    </header>

    <section class="demo-section">
      <h2>Try It</h2>
      <p>Click the button below to test the human verification system. You have 10 seconds to pass all checks by moving your mouse naturally and hitting the targets.</p>
      <button class="btn btn-primary" onclick="runDemo()">Start Verification</button>
      <div id="result" class="result"></div>
    </section>

    <section class="demo-section">
      <h2>How It Works</h2>
      <p>The system analyzes your mouse movements in real-time using 7 independent detection checks that identify human movement characteristics:</p>
      <div class="features">
        <div class="feature">
          <h3>Movement Analysis</h3>
          <p>Detects natural speed variation, acceleration, and deceleration patterns</p>
        </div>
        <div class="feature">
          <h3>Path Detection</h3>
          <p>Identifies smooth human curves vs. straight robotic line segments</p>
        </div>
        <div class="feature">
          <h3>Timing Patterns</h3>
          <p>Analyzes natural pauses and continuous movement flow</p>
        </div>
        <div class="feature">
          <h3>Target Tracking</h3>
          <p>Interactive challenge requiring purposeful mouse control</p>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h2>Installation</h2>
      <div class="code-section">
        <code><span class="comment">// Download from GitHub</span>
<span class="string">https://github.com/dshanklin-bv/ai-mouse-check</span>

<span class="comment">// Include in your HTML</span>
&lt;script src="<span class="string">ai-mouse-check.js</span>"&gt;&lt;/script&gt;</code>
      </div>
    </section>

    <section class="demo-section">
      <h2>Basic Usage</h2>
      <div class="code-section">
        <code><span class="keyword">const</span> checker = <span class="keyword">new</span> <span class="function">AIMouseCheck</span>({
  timeout: <span class="string">10000</span>,
  <span class="function">onSuccess</span>: (result) => {
    console.log(<span class="string">'Human verified!'</span>, result.signature);
  },
  <span class="function">onFailure</span>: (result) => {
    console.log(<span class="string">'Failed'</span>, result.reason);
    <span class="keyword">if</span> (result.aiDetected) {
      console.log(<span class="string">'AI detected!'</span>);
    }
  }
});

checker.<span class="function">verify</span>();</code>
      </div>
    </section>

    <section class="demo-section">
      <h2>Cryptographic Signing for Database Entries</h2>
      <p>For tamper-proof verification, send movement data to your server to generate a cryptographic signature that proves human verification occurred.</p>

      <h3 style="color: #06d6a0; font-size: 1rem; margin: 20px 0 10px;">Client-Side: Send to Server</h3>
      <div class="code-section">
        <code><span class="keyword">const</span> checker = <span class="keyword">new</span> <span class="function">AIMouseCheck</span>({
  <span class="function">onSuccess</span>: <span class="keyword">async</span> (result) => {
    <span class="comment">// Send movement data to server for cryptographic signing</span>
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'/api/human-verify'</span>, {
      method: <span class="string">'POST'</span>,
      headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
      body: JSON.<span class="function">stringify</span>({
        recordId: <span class="string">'task-123'</span>,
        movementData: result.movementData,
        clientSignature: result.signature
      })
    });

    <span class="keyword">const</span> { signature, timestamp } = <span class="keyword">await</span> response.<span class="function">json</span>();
    console.log(<span class="string">'Server signature:'</span>, signature);
  }
});</code>
      </div>

      <h3 style="color: #06d6a0; font-size: 1rem; margin: 20px 0 10px;">Server-Side: Generate Signature (Node.js)</h3>
      <div class="code-section">
        <code><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">'crypto'</span>;

<span class="comment">// Secret key - store securely (env var, secrets manager)</span>
<span class="keyword">const</span> SECRET_KEY = process.env.VERIFICATION_SECRET;

app.<span class="function">post</span>(<span class="string">'/api/human-verify'</span>, (req, res) => {
  <span class="keyword">const</span> { recordId, movementData, clientSignature } = req.body;

  <span class="comment">// Hash the movement data</span>
  <span class="keyword">const</span> movementHash = crypto
    .<span class="function">createHash</span>(<span class="string">'sha256'</span>)
    .<span class="function">update</span>(JSON.<span class="function">stringify</span>(movementData))
    .<span class="function">digest</span>(<span class="string">'hex'</span>);

  <span class="comment">// Generate cryptographic signature</span>
  <span class="keyword">const</span> timestamp = Date.<span class="function">now</span>();
  <span class="keyword">const</span> signature = crypto
    .<span class="function">createHmac</span>(<span class="string">'sha256'</span>, SECRET_KEY)
    .<span class="function">update</span>(<span class="string">`\${recordId}:\${movementHash}:\${timestamp}`</span>)
    .<span class="function">digest</span>(<span class="string">'hex'</span>);

  <span class="comment">// Store in database with the record</span>
  db.<span class="function">run</span>(<span class="string">`
    UPDATE records SET
      human_verified_at = datetime('now'),
      verification_signature = ?
    WHERE id = ?
  `</span>, [signature, recordId]);

  res.<span class="function">json</span>({ verified: <span class="keyword">true</span>, signature, timestamp });
});</code>
      </div>

      <h3 style="color: #06d6a0; font-size: 1rem; margin: 20px 0 10px;">Database Schema</h3>
      <div class="code-section">
        <code><span class="comment">-- Add verification columns to your table</span>
<span class="keyword">ALTER TABLE</span> records <span class="keyword">ADD COLUMN</span> human_verified_at <span class="string">DATETIME</span>;
<span class="keyword">ALTER TABLE</span> records <span class="keyword">ADD COLUMN</span> verification_signature <span class="string">TEXT</span>;

<span class="comment">-- Query verified records</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> records
<span class="keyword">WHERE</span> human_verified_at <span class="keyword">IS NOT NULL</span>;</code>
      </div>

      <h3 style="color: #06d6a0; font-size: 1rem; margin: 20px 0 10px;">Verify Signature Later</h3>
      <div class="code-section">
        <code><span class="keyword">function</span> <span class="function">verifySignature</span>(recordId, movementHash, timestamp, signature) {
  <span class="keyword">const</span> expected = crypto
    .<span class="function">createHmac</span>(<span class="string">'sha256'</span>, SECRET_KEY)
    .<span class="function">update</span>(<span class="string">`\${recordId}:\${movementHash}:\${timestamp}`</span>)
    .<span class="function">digest</span>(<span class="string">'hex'</span>);

  <span class="keyword">return</span> crypto.<span class="function">timingSafeEqual</span>(
    Buffer.<span class="function">from</span>(signature),
    Buffer.<span class="function">from</span>(expected)
  );
}</code>
      </div>

      <div class="features" style="margin-top: 25px;">
        <div class="feature">
          <h3>Tamper-Proof</h3>
          <p>HMAC signature proves the verification happened and data wasn't modified</p>
        </div>
        <div class="feature">
          <h3>Auditable</h3>
          <p>Timestamp and signature stored with each record for compliance</p>
        </div>
        <div class="feature">
          <h3>Verifiable</h3>
          <p>Re-compute signature anytime to verify authenticity</p>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h2>Use Cases</h2>
      <div class="features">
        <div class="feature">
          <h3>Task Completion</h3>
          <p>Require human approval before marking tasks complete in project management systems</p>
        </div>
        <div class="feature">
          <h3>Financial Approval</h3>
          <p>Verify human authorization for transactions, refunds, or account changes</p>
        </div>
        <div class="feature">
          <h3>Content Moderation</h3>
          <p>Ensure a human reviewed and approved content before publishing</p>
        </div>
        <div class="feature">
          <h3>AI Guardrails</h3>
          <p>Prevent AI agents from autonomously completing sensitive operations</p>
        </div>
      </div>
    </section>

    <footer>
      <p>MIT License &middot; <a href="https://github.com/dshanklin-bv/ai-mouse-check">GitHub</a> &middot; Created by <a href="https://github.com/dshanklin-bv">dshanklin-bv</a></p>
    </footer>
  </div>

  <script src="ai-mouse-check.js?v=1.4.0"></script>
  <script>
    console.log('AI Mouse Check demo loaded v1.4.0 - FRESH LOAD');

    function generateAIPrompt(movementData, verified) {
      const samplePoints = movementData.slice(0, 50); // First 50 points
      const prompt = `Analyze this mouse movement data and determine if it appears to be from a human or an AI/bot.

The data represents ${movementData.length} movement points recorded during a human verification test.
Each point has x (horizontal position), y (vertical position), and t (timestamp in milliseconds).

Here is a sample of the movement data (first 50 points):
${JSON.stringify(samplePoints, null, 2)}

Summary statistics:
- Total points: ${movementData.length}
- Duration: ${movementData.length > 1 ? ((movementData[movementData.length-1].t - movementData[0].t) / 1000).toFixed(2) : 0} seconds
- Points per second: ${movementData.length > 1 ? (movementData.length / ((movementData[movementData.length-1].t - movementData[0].t) / 1000)).toFixed(1) : 0}

Please analyze:
1. Does the movement show natural speed variation (acceleration/deceleration)?
2. Are the paths curved naturally or straight robotic lines?
3. Is there natural micro-jitter/tremor in the movement?
4. Are the timing gaps between points consistent with human behavior?
5. Does it look like continuous human mouse movement or discrete AI jumps?

Based on your analysis, does this appear to be HUMAN or AI/BOT movement?`;
      return prompt;
    }

    function copyPrompt(btn) {
      const textarea = btn.parentElement.querySelector('textarea');
      textarea.select();
      document.execCommand('copy');
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'Copy Prompt';
        btn.classList.remove('copied');
      }, 2000);
    }

    async function verifyWithServer(movementData, targetHits) {
      try {
        const response = await fetch('/api/verify', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            points: movementData,
            targetHits: targetHits,
            recordId: 'human-test-' + Date.now()
          })
        });
        return await response.json();
      } catch (e) {
        console.error('Server verify failed:', e);
        return null;
      }
    }

    async function recordHumanResult(passed, serverResult) {
      try {
        const response = await fetch('/api/record-result', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            isHuman: true,
            passed: passed,
            metrics: serverResult?.metrics || {},
            detectionVersion: serverResult?.detectionVersion || 'unknown',
            detectionConfig: serverResult?.detectionConfig || null
          })
        });
        const data = await response.json();
        console.log('Confusion matrix:', data.matrix);
        return data;
      } catch (e) {
        console.error('Record result failed:', e);
        return null;
      }
    }

    function runDemo() {
      const resultEl = document.getElementById('result');
      resultEl.className = 'result';
      resultEl.style.display = 'none';

      let alreadyVerified = false;

      const checker = new AIMouseCheck({
        timeout: 10000,
        targetHitsRequired: 5,
        onTargetHit: (targetHits, totalRequired, movementData) => {
          console.log('onTargetHit fired:', targetHits, '/', totalRequired);
          if (targetHits >= 5 && !alreadyVerified) {
            alreadyVerified = true;
            console.log('5 hits - auto-verifying with', movementData.length, 'points');

            // Use fetch directly (no await needed in sync callback)
            fetch('/api/verify', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ points: movementData, targetHits: 5 })
            })
            .then(r => r.json())
            .then(serverResult => {
              console.log('Server result:', serverResult);
              const passed = serverResult.verified;

              // Record to confusion matrix
              fetch('/api/record-result', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  isHuman: true,
                  passed: passed,
                  metrics: serverResult.metrics,
                  detectionVersion: serverResult.detectionVersion,
                  detectionConfig: serverResult.detectionConfig
                })
              }).then(r => r.json()).then(d => console.log('Recorded:', d.matrix));

              // Show result
              resultEl.className = passed ? 'result success' : 'result failure';
              resultEl.innerHTML = `
                <h3>Server: ${passed ? '✓ PASSED' : '✗ FAILED'}</h3>
                <p>Checks: ${serverResult.checksPassed}/7</p>
                <pre>${JSON.stringify(serverResult, null, 2)}</pre>
                <p><a href="/api/confusion-matrix" target="_blank">View Confusion Matrix</a></p>
              `;
            })
            .catch(e => console.error('Verify error:', e));
          }
        },
        onSuccess: async (result) => {
          // Skip if already verified via onTargetHit
          if (alreadyVerified) return;

          const serverResult = await verifyWithServer(result.movementData, 5);
          const passed = serverResult ? serverResult.verified : true;
          await recordHumanResult(passed, serverResult);

          const aiPrompt = generateAIPrompt(result.movementData, true);
          const resultWithoutData = { ...result };
          delete resultWithoutData.movementData;

          resultEl.className = passed ? 'result success' : 'result failure';
          resultEl.innerHTML = `
            <h3>${passed ? 'Verified!' : 'Server Verification Failed'}</h3>
            <p>You passed all client checks in ${(result.duration / 1000).toFixed(1)} seconds.</p>
            <p style="color: #4cc9f0;">Server: ${passed ? 'PASSED' : 'FAILED'} |
              <a href="/api/confusion-matrix" target="_blank" style="color: #06d6a0;">View Confusion Matrix</a>
            </p>
            <pre>${JSON.stringify(serverResult || resultWithoutData, null, 2)}</pre>
            <div class="ai-prompt-section">
              <h4>Ask an AI to verify this movement data:</h4>
              <div class="ai-prompt-box">
                <button class="copy-btn" onclick="copyPrompt(this)">Copy Prompt</button>
                <textarea readonly>${aiPrompt}</textarea>
              </div>
              <p style="margin-top: 10px; font-size: 0.85rem; color: #888;">
                Copy this prompt and paste it into ChatGPT, Claude, or any AI to get a second opinion on whether the movement looks human.
              </p>
            </div>
          `;
        },
        onFailure: async (result) => {
          // Skip if already verified via onTargetHit
          if (alreadyVerified) return;

          const serverResult = await verifyWithServer(result.movementData, result.targetHits || 0);
          const passed = serverResult ? serverResult.verified : false;
          await recordHumanResult(passed, serverResult);

          const aiPrompt = generateAIPrompt(result.movementData, false);
          const resultWithoutData = { ...result };
          delete resultWithoutData.movementData;

          resultEl.className = 'result failure';
          resultEl.innerHTML = `
            <h3>Failed${result.aiDetected ? ' - AI Detected' : ''}</h3>
            <p>Reason: ${result.reason} | Checks passed: ${result.checksPassed}/7</p>
            <p style="color: #4cc9f0;">Server: ${passed ? 'PASSED' : 'FAILED'} |
              <a href="/api/confusion-matrix" target="_blank" style="color: #06d6a0;">View Confusion Matrix</a>
            </p>
            <pre>${JSON.stringify(serverResult || resultWithoutData, null, 2)}</pre>
            <div class="ai-prompt-section">
              <h4>Ask an AI to analyze this movement data:</h4>
              <div class="ai-prompt-box">
                <button class="copy-btn" onclick="copyPrompt(this)">Copy Prompt</button>
                <textarea readonly>${aiPrompt}</textarea>
              </div>
              <p style="margin-top: 10px; font-size: 0.85rem; color: #888;">
                Copy this prompt and paste it into ChatGPT, Claude, or any AI to analyze why the movement might have failed.
              </p>
            </div>
          `;
        }
      });

      checker.verify();
    }
  </script>
</body>
</html>
